<!DOCTYPE html>
<html>
<head>
    <title>Processing OAuth...</title>
    <script>
        window.onload = async function () {
            const params = new URLSearchParams(window.location.search);
            const code = params.get("code");
            if (!code) {
                document.body.innerHTML = "<h2>Error: No authorization code received.</h2>";
                return;
            }

            // Відправляємо запит на сервер Notion для отримання access_token
            try {
                const response = await fetch("https://api.notion.com/v1/oauth/token", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Basic " + btoa("YOUR_CLIENT_ID:YOUR_CLIENT_SECRET")
                    },
                    body: JSON.stringify({
                        grant_type: "authorization_code",
                        code: code,
                        redirect_uri: "https://ruslanlap.github.io/notiq-notionmanger-firefox/"
                    })
                });

                const data = await response.json();
                if (data.access_token) {
                    localStorage.setItem("notion_access_token", data.access_token);
                    document.body.innerHTML = "<h2>Authorization successful!</h2>";
                } else {
                    document.body.innerHTML = `<h2>Error: ${data.error || "Unknown error"}</h2>`;
                }
            } catch (error) {
                document.body.innerHTML = `<h2>Request failed: ${error.message}</h2>`;
            }
        };
    </script>
</head>
<body>
    <h2>Processing OAuth...</h2>
</body>
</html>
